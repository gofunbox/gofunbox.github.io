
<!DOCTYPE html>
<html lang="en" data-figures="" class="page" data-mode="dim">
  <head>
<title>Discuz! 的编码规范 | Funbox的技术记事本</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.58.3" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<div style="display: none;">
    <script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1253534284&web_id=1253534284"></script>
</div>

  
<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="前言  本规范由编程原则组成，融合并提炼了开发人员长时间积累下来的成熟经验，意在帮助形成良好一致的编程风格。  适用范围  如无特殊说明，以下规则要求完全适用于Discuz!项目，同时也可大部分适用于COMSENZ旗下其他PHP项目。  标准化的重要性和好处  当一个软件项目尝试着遵守公共一致的标准时，可以使参与项目的 …">
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="Discuz! 的编码规范" />
<meta property="og:url" content="https://gofunbox.github.io/463.html" />
<meta property="og:title" content="Discuz! 的编码规范" />
<meta property="og:description" content="前言  本规范由编程原则组成，融合并提炼了开发人员长时间积累下来的成熟经验，意在帮助形成良好一致的编程风格。  适用范围  如无特殊说明，以下规则要求完全适用于Discuz!项目，同时也可大部分适用于COMSENZ旗下其他PHP项目。  标准化的重要性和好处  当一个软件项目尝试着遵守公共一致的标准时，可以使参与项目的 …" />
<meta property="og:image" content="https://gofunbox.github.io/" />
<link rel="apple-touch-icon" sizes="180x180" href='https://gofunbox.github.io/icons/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='https://gofunbox.github.io/icons/favicon-32x32.png'>
<link rel="manifest" href='https://gofunbox.github.io/icons/site.webmanifest'>
<link rel="mask-icon" href='https://gofunbox.github.io/safari-pinned-tab.svg' color="#002538">
<meta name="msapplication-TileColor" content="#002538">
<meta name="theme-color" content="#002538">

<link rel="canonical" href="https://gofunbox.github.io/463.html">

    

    
    
    <link rel="preload" href="https://gofunbox.github.io/css/styles.3c293eda0641c6491efdbc2ddc32d1ec05b0f4b4d4111d3fdc31d8bdfce311412eed47cf75d02001b067f5032e10e1f9ec0ae5175e17d82f68691f5ebffcab39.css" integrity = "sha512-PCk&#43;2gZBxkke/bwt3DLR7AWw9LTUER0/3DHYvfzjEUEu7UfPddAgAbBn9QMuEOH57ArlF14X2C9oaR9ev/yrOQ==" as="style" crossorigin="anonymous">
    <link rel="preload" href="https://gofunbox.github.io/js/bundle.min.b672f2cf44052c113d188829e5f5d141a97ea83ade7b0c53f92ccb4e415435f0295af95e80e8d88a98bfa8af4c5818e3a2264621195c9cbf74f3c33ca66265d7.js" as="script" integrity=
    "sha512-tnLyz0QFLBE9GIgp5fXRQal&#43;qDreewxT&#43;SzLTkFUNfApWvlegOjYipi/qK9MWBjjoiZGIRlcnL9088M8pmJl1w==" crossorigin="anonymous">

    
    <link rel="stylesheet" type="text/css" href="https://gofunbox.github.io/css/styles.3c293eda0641c6491efdbc2ddc32d1ec05b0f4b4d4111d3fdc31d8bdfce311412eed47cf75d02001b067f5032e10e1f9ec0ae5175e17d82f68691f5ebffcab39.css" integrity="sha512-PCk&#43;2gZBxkke/bwt3DLR7AWw9LTUER0/3DHYvfzjEUEu7UfPddAgAbBn9QMuEOH57ArlF14X2C9oaR9ev/yrOQ==" crossorigin="anonymous">
    
  </head>
  
  
    
  
  <body data-code="100" data-lines="false" id="documentTop">

<header class="nav_header" >
  <nav class="nav">
    <a href='https://gofunbox.github.io/' class="nav_brand nav_item">
        Funbox的技术记事本
      <div class="nav_close">
        <div>
          <svg class="icon">
  <use xlink:href="#open-menu"></use>
</svg>
          <svg class="icon">
  <use xlink:href="#closeme"></use>
</svg>
        </div>
      </div>
    </a>
    <div class='nav_body nav_body_'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://gofunbox.github.io/" class="nav_item">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://gofunbox.github.io/about/" class="nav_item">About </a>
  </div>
      
      <div class="nav_parent">
        <a href="#" class="nav_item"></a>
        <div class="nav_sub">
          <span class="nav_child"></span>
          
          <a href="https://gofunbox.github.io/zh/" class="nav_child nav_item">中文</a>
          
          <a href="https://gofunbox.github.io/" class="nav_child nav_item"></a>
          
        </div>
      </div>
      
<div class='follow'>
  <a href="https://github.com/gofunbox">
    <svg class="icon">
  <use xlink:href="#github"></use>
</svg>
  </a>
    
  <a href="https://gofunbox.github.io/index.xml">
    <svg class="icon">
  <use xlink:href="#rss"></use>
</svg>
  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Discuz! 的编码规范</h1><div class="post_meta">
  <svg class="icon">
  <use xlink:href="#calendar"></use>
</svg>
  <span class="post_date">
    Feb 19, 2013</span>
</div>

    
<div class="post_share">
  Share on:
  <a href="https://twitter.com/intent/tweet?text=Discuz%21%20%e7%9a%84%e7%bc%96%e7%a0%81%e8%a7%84%e8%8c%83&url=https%3a%2f%2fgofunbox.github.io%2f463.html&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
    <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
  </a>
  <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fgofunbox.github.io%2f463.html&t=Discuz%21%20%e7%9a%84%e7%bc%96%e7%a0%81%e8%a7%84%e8%8c%83" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
    <svg class="icon">
  <use xlink:href="#facebook"></use>
</svg>
  </a>
  <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
    <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
  </a>
  <a href="https://gofunbox.github.io/463.html" title="Copy Link" class="link link_yank">
    <svg class="icon">
  <use xlink:href="#copy"></use>
</svg>
  </a>
</div>

    
    

<h2 id="前言"><strong>前言</strong></h2>

<dl>
<dd>本规范由编程原则组成，融合并提炼了开发人员长时间积累下来的成熟经验，意在帮助形成良好一致的编程风格。</dd>
</dl>

<h2 id="适用范围"><strong>适用范围</strong></h2>

<dl>
<dd>如无特殊说明，以下规则要求完全适用于Discuz!项目，同时也可大部分适用于COMSENZ旗下其他PHP项目。</dd>
</dl>

<h2 id="标准化的重要性和好处"><strong>标准化的重要性和好处</strong></h2>

<dl>
<dd><p>当一个软件项目尝试着遵守公共一致的标准时，可以使参与项目的开发人员更容易了解项目中的代码、弄清程序的状况。使新的参与者可以很快的适应环境，防止部分参与者出于节省时间的需要，自创一套风格并养成终生的习惯，导致其它人在阅读时浪费过多的时间和精力。而且在一致的环境下，也可以减少编码出错的机会。缺陷是由于每个人的标准不同，所以需要一段时间来适应和改变自己的编码风格，暂时性的降底了工作效率。从使项目长远健康的发展以及后期更高的团队工作效率来考虑暂时的工作效率降低是值得的，也是必须要经过的一个过程。标准不是项目成功的关键，但可以帮助我们在团队协作中有更高的效率并且更加顺利的完成既定的任务。</p></p>

<dl>
<dd>* <strong>程序员可以了解任何代码，弄清程序的状况</strong>

<ul>
<li><strong>新人可以很快的适应环境</strong></li>
<li><strong>防止新接触PHP的人出于节省时间的需要，自创一套风格并养成终生的习惯</strong></li>
<li><strong>防止新接触PHP的人一次次的犯同样的错误</strong></li>
<li><strong>在一致的环境下，人们可以减少犯错的机会</strong></li>
<li><strong>程序员们有了一致的敌人</strong></li>
</ul></dd>
</dl></dd>
</dl>

<h2 id="php编码规范与原则"><strong>PHP编码规范与原则</strong></h2>

<h3 id="代码标记">代码标记</h3>

<dl>
<dd>PHP程序可以使用<strong>&lt;?php ?&gt;</strong>来界定 PHP 代码，在HTML页面中嵌入纯变量时，可以使用<strong>&lt;?php echo $variablename;?&gt;</strong>这样的形式。</dd>
<dd><strong>注意：</strong>为了使代码进一步规范化和标准化，从Discuz! X2版本起开始禁用<strong>&lt;? ?&gt;</strong>和<strong>&lt;?=$variablename?&gt;</strong>这种速记形式。</dd>
</dl>

<h3 id="注释">注释</h3>

<dl>
<dd>注释是对于那些容易忘记作用的代码添加简短的介绍性内容。请使用 C 样式的注释“/* */”和标准 C++ 注释“//”。</dd>
<dd><p>在Discuz!每一个程序文件头部中，应放入相应SVN控制字串，以方便SVN提交时自动更新：</p>

<ul>
<li><strong>$Id$</strong></li>
</ul></dd>
</dl>

<p>例如：</p>

<pre>/**
 *      [Discuz!] (C)2001-2099 Comsenz Inc.
 *      This is NOT a freeware, use is subject to license terms
 *
 *      $Id$
 */</pre>
:   程序开发中难免留下一些临时代码和调试代码，此类代码必须添加注释，以免日后遗忘。所有临时性、调试性、试验性的代码，必须添加统一的注释标记“//debug”并后跟完整的注释信息，这样可以方便在程序发布和最终调试前批量检查程序中是否还存在有疑问的代码。例如：

<pre>$num = 1;
$flag = TRUE;   //debug 这里不能确定是否需要对$flag进行赋值
if(empty($flag)) {
    //Statements
}</pre>

<h3 id="书写规则">书写规则</h3>

<h4 id="缩进">缩进</h4>

<dl>
<dd><strong>每个缩进的单位约定是一个TAB(4个空白字符宽度)</strong>，需每个参与项目的开发人员在编辑器(UltraEdit、EditPlus、Zend Studio等)中进行强制设定，以防在编写代码时遗忘而造成格式上的不规范。</dd>
<dd>本缩进规范适用于PHP、JavaScript中的函数、类、逻辑结构、循环等。</dd>
</dl>

<h4 id="大括号-if和switch">大括号{}、if和switch</h4>

<dl>
<dd>* 首括号与关键词同行，尾括号与关键字同列；

<ul>
<li>if结构中，else和elseif与前后两个大括号同行，左右各一个空格。另外，即便if后只有一行语句，仍然需要加入大括号，以保证结构清晰；</li>
<li>switch结构中，通常当一个case块处理后，将跳过之后的case块处理，因此大多数情况下需要添加break。break的位置视程序逻辑，与case同在一行，或新起一行均可，但同一switch体中，break的位置格式应当保持一致。</li>
</ul></dd>
</dl>

<p>以下是符合上述规范的例子：</p>

<pre>if($condition) {
    switch($var) {
        case 1:     echo ‘var is 1’; break;
        case 2:     echo ‘var is 2’; break;
        default:    echo ‘var is neither 1 or 2’; break;
    }
} else {
    switch($str) {
        case ‘abc’:
            $result = ‘abc’;
            break;
        default:
            $result = ‘unknown’;
            break;
    }
}</pre>

<h4 id="运算符-小括号-空格-关键词和函数">运算符、小括号、空格、关键词和函数</h4>

<dl>
<dd>* 每个运算符与两边参与运算的值或表达式中间要有一个空格，唯一的特例是字符连接运算符号两边不加空格；

<ul>
<li>左括号“(” 应和函数关键词紧贴在一起，除此以外应当使用空格将“(”同前面内容分开；</li>
<li>右括号“)”除后面是“)”或者“.”以外，其他一律用空格隔开它们；</li>
<li>除字符串中特意需要，一般情况下，在程序以及HTML中不出现两个连续的空格；</li>
<li>任何情况下，PHP程序中不能出现空白的带有TAB或空格的行，即：这类空白行应当不包含任何TAB或空格。同时，任何程序行尾也不能出现多余的TAB或空格。多数编辑器具有自动去除行尾空格的功能，如果习惯养成不好，可临时使用它，避免多余空格产生；</li>
<li>每段较大的程序体，上、下应当加入空白行，两个程序块之间只使用1个空行，禁止使用多行。</li>
<li>程序块划分尽量合理，过大或者过小的分割都会影响他人对代码的阅读和理解。一般可以以较大函数定义、逻辑结构、功能结构来进行划分。少于15行的程序块，可不加上下空白行；</li>
<li>说明或显示部分中，内容如含有中文、数字、英文单词混杂，应当在数字或者英文单词的前后加入空格。</li>
</ul></dd>
<dd>根据上述原则，以下举例说明正确的书写格式：</dd>
</dl>

<pre>$result = (($a + 1) * 3 / 2 + $num)).’Test’;
$condition ? func1($var) : func2($var);
$condition ? $long_statement : $another_long_statement;
if($flag) {

    //Statements
    //More than 15 lines

}
showmessage(‘请使用 restore.php 工具恢复数据。’);</pre>

<h4 id="函数定义">函数定义</h4>

<dl>
<dd>* 参数的名字和变量的命名规范一致；

<ul>
<li>函数定义中的左小括号，与函数名紧挨，中间无需空格；</li>
<li>开始的左大括号与函数定义为同一行，中间加一个空格，不要另起一行；</li>
<li>具有默认值的参数应该位于参数列表的后面；</li>
<li>函数调用与定义的时候参数与参数之间加入一个空格；</li>
<li>必须仔细检查并切实杜绝函数起始缩进位置与结束缩进位置不同的现象；</li>
</ul></dd>
<dd>例如，符合标准的定义：</dd>
</dl>

<pre>function authcode($string, $operation, $key = '') {
    if($flag) {
        //Statement
    }
    //函数体
}</pre>
:   不符合标准的定义：

<pre>function authcode($string,$operation,$key = '')
{
    //函数体
}</pre>

<h4 id="引号">引号</h4>

<dl>
<dd><p>PHP中单引号和双引号具有不同的含义，最大的几项区别如下：</p></p>

<ul>
<li>单引号中，任何变量($var)、特殊转义字符(如“\t \r \n”等)不会被解析，因此PHP的解析速度更快，转义字符仅仅支持“\’”和“\”这样对单引号和反斜杠本身的转义；</li>
<li>双引号中，变量($var)值会代入字符串中，特殊转义字符也会被解析成特定的单个字符，还有一些专门针对上述两项特性的特殊功能性转义，例如“\$”和“{$array[‘key’]}。这样虽然程序编写更加方便，但同时PHP的解析也很慢；</li>
<li>数组中，如果下标不是整型，而是字符串类型，请务必用单引号将下标括起，正确的写法为$array[‘key’]，而不是$array[key]，因为不正确的写法会使PHP解析器认为key是一个常量，进而先判断常量是否存在，不存在时才以“key”作为下标带入表达式中，同时出发错误事件，产生一条Notice级错误。</li>
<li>因此，在绝大多数可以使用单引号的场合，禁止使用双引号。依据上述分析，可以或必须使用单引号的情况包括但不限于下述：

<ul>
<li>字符串为固定值，不包含“\t”等特殊转义字符；</li>
<li>数组的固定下标，例如$array[‘key’]；</li>
<li>表达式中不需要带入变量，例如$string = ‘test’;，而非$string = “test$var”；</li>
</ul></li>
<li>例外的，在正则表达式(用于preg_系列函数和ereg系列函数)中，Discuz!全部使用双引号，这是为了人工分析和编写的方便，并保持正则表达式的统一，减少不必要的分析混淆。</li>
<li>数据库SQL语句中，所有数据必须加单引号，无论数值还是字串，以避免可能的注入漏洞和SQL错误。正确的写法为：</li>
</ul></dd>
<dt><pre>UPDATE cdb_members SET adminid=’1’ WHERE username=’$admin’ AND adminid=’2’;</pre></dt>
<dd><p>所有数据在插入数据库之前，均需要进行addslashes()处理，以免特殊字符未经转义在插入数据库的时候出现错误。Discuz!中所有通过 GET, POST, FILE,取得的变量默认情况下已经使用了addslashes()进行了转义，不必重复进行。如果数据处理必要(例如用于直接显示)，可以使用 stripslashes() 恢复，但数据在插入数据库之前必须再次进行转义。缓存文件中，一般对缓存数据的值采用 addcslashes($string, &#8216;&amp;#8217;\&#8217;)进行转义。</p></dd>
</dl>

<h4 id="discuz-语言问题">Discuz!语言问题</h4>

<dl>
<dd>在功能设计阶段，当需要使用中文或者给出用户中文提示的时候可以直接在程序中插入简体中文文字，待程序整理和测试阶段由专人进行语言分离工作；</dd>
<dd>功能说明性语言、短语一般不使用“。”或者其他标点符号作为结束，文字中的标点符号，应使用全角。但注意：由于中英文模板与语言包问题，功能说明性的语言中，冒号使用半角”:”，而不使用全角；</dd>
<dd>提示信息(用showmessage()和cpmsg()显示的)和使用技巧(如后台管理界面中的tips)等大篇幅文字中，当中的标点符号应当遵循中文语法规则，以使用全角中文标点为主，结尾应当加入全角句号。</dd>
<dd>尽管程序语言包是在最后整理阶段才进行提取，但程序中直接写出的中文内容，也应充分保证书面语的特征：语言通顺、简洁、得体、无歧义。应彻底杜绝认为直接写提示语言是临时性操作的想法，反复推敲，并总结之前提示语言的特征规范，加以应用。良好的语言文字表达能力，是每个优秀程序员必须具备的基本素质之一。</dd>
</dl>

<h3 id="命名原则">命名原则</h3>

<dl>
<dd>命名是程序规划的核心。古人相信只要知道一个人真正的名字就会获得凌驾于那个人之上的不可思议的力量。只要你给事物想到正确的名字，就会给你以及后来的人带来比代码更强的力量。</dd>
<dd>名字就是事物在它所处的生态环境中一个长久而深远的结果。总的来说，只有了解系统的程序员才能为系统取出最合适的名字。如果所有的命名都与其自然相适合，则关系清晰，含义可以推导得出，一般人的推想也能在意料之中。</dd>
<dd>就一般约定而言，类、函数和变量的名字应该总是能够描述让代码阅读者能够容易的知道这些代码的作用。形式越简单、越有规则，就越容易让人感知和理解。应该避免使用模棱两可，晦涩不标准的命名。</dd>
</dl>

<p>&nbsp;</p>

<h4 id="变量-对象-函数名">变量、对象、函数名</h4>

<dl>
<dd>* 变量、对象、函数名一律为小写格式，除非必要，单词之间一般不使用下划线“_”进行分割；

<ul>
<li>以标准计算机英文为蓝本，杜绝一切拼音、或拼音英文混杂的命名方式；</li>
<li>变量命名只能使用项目中有据可查的英文缩写方式，例如可以使用$data而不可使用$data1、$data2这样容易产生混淆的形式，应当使用$threaddata、$postdata这样一目了然容易理解的形式；</li>
<li>可以合理的对过长的命名进行缩写，例如$bio($biography)，$tpp($threadsPerPage)，前提是英文中有这样既有的缩写形式，或字母符合英文缩写规范；</li>
<li>必须清楚所使用英文单词的词性，在权限相关的范围内，大多使用$allow*\**或$is***的形式，前者后面接动词，后者后面接形容词。</li>
</ul></dd>
</dl>

<h4 id="常量">常量</h4>

<dl>
<dd>* 常量应该总是全部使用大写字母命名，少数特别必要的情况下，可使用划线来分隔单词；

<ul>
<li>PHP 的内建值 TRUE、FALSE 和NULL必须全部采用大写字母书写。</li>
</ul></dd>
</dl>

<h3 id="变量的初始化与逻辑检查">变量的初始化与逻辑检查</h3>

<p><strong>任何变量在进行累加、直接显示或存储前必需进行初使化</strong>,例如：</p>

<pre>$number = 0;           //数值型初始化
$string = ‘’;       //字符串初始化
$array = array();   //数组初始化</pre>

<ul>
<li>判断一个无法确定（不知道是否已被赋值）的变量时，可用empty()或isset()，而不要直接使用if($switch)的形式，除非你确切的知道此变量一定已经被初始化并赋值。</li>

<li><p><strong>empty()和isset()的区别为：</strong></p></p>

<ul>
<li><p><strong>bool empty(mixed var)</strong></p></li>

<li><p>如果 var 是非空或非零的值，则 empty() 返回 FALSE。换句话说，&#8221;&#8221;、0、&#8221;0&#8243;、NULL、FALSE、array()、var $var; 以及没有任何属性的对象都将被认为是空的，如果 var 为空，则返回 TRUE。</p>

<ul>
<li><strong>bool isset(mixed var[, mixed var[, &#8230;]])</strong>
<br /></li>
</ul></li>

<li><ul>
<li>如果 var 存在则返回 TRUE，否则返回 FALSE。</li>
</ul></li>
</ul></li>

<li><dl>
<dd>* 如果已经使用 unset() 释放了一个变量之后，它将不再是 isset()。若使用 isset() 测试一个被设置成 NULL 的变量，将返回 FALSE。同时要注意的是一个 NULL 字节（&#8221;\0&#8243;）并不等同于 PHP 的 NULL 常数。</dd>
</dl>

<ul>
<li>判断一个变量是否为数组，请使用is_array()，这种判断尤其适用于对数组进行遍历的操作，例如foreach()，因为如果不事先判断，foreach()会对非数组类型的变量报错；</li>
<li>判断一个数组元素是否存在，可使用isset($array[‘key’])，也可使用empty()，两者异同见上。</li>
</ul></li>
</ul>

<h3 id="安全性">安全性</h3>

<dl>
<dd>PHP中的变量不并不像C语言那样需要事先声明，解释器会在第一次使用时自动创建他们，同样类型也不需要指定，解释器会根据上下文环境自动确定。从开发人员的角度来看，这无疑是一种极其方便的处理方法。一个变量被创建了，就可以在程序中的任何地方使用。这导致的结果就是开发人员工经常不注意初始化变量。因此，为了提高程序的安全性，我们不能相信任何没有明确定义的变量。所有的变量在定义使用前要初使化以防止恶意构造提交的变量覆盖程序中使用的变量。</dd>
</dl>

<h3 id="兼容性">兼容性</h3>

<dl>
<dd>* 代码设计应当兼顾PHP 高低版本的特性，当前，应仍然以PHP 4.0.6作为最低通过平台，尽量不使用高版本PHP 新增的函数、常数或者常量。如果使用只在高版本才具备的函数，必须对其进行二次封装，自动判断当前PHP版本，并自行编写低版本下的兼容代码；

<ul>
<li>对于个别函数，参数要求或者代码要求应当以较为严格的PHP版本为准；</li>
<li>除非必要，不要使用PHP扩展模块中的函数。使用时应当加入必要的判断，当服务器环境不支持此函数的时候，进行必要的处理。文档和程序中的功能说明中，也应加上兼容性说明。</li>
</ul></dd>
</dl>

<h3 id="代码重用">代码重用</h3>

<dl>
<dd>代码的有效重用可以减少效率的损失与资源的浪费。在开发软件项目时为了避免重复劳动和浪费时间。开发人员应尽量提高现有代码的重用率，同时将更多的精力用在新技术的应用和新功能的创新开发上面。</dd>
<dd>:     * 在需要多次使用代码，并且对于您希望实现的任务没有可用的内置 PHP 函数时，不吝啬定义函数或类。开发者须根据功能、调用情况，将函数和类放置于相应的function或class中。超过3行，实现相同功能的程序切勿在不同程序中多次出现，这是无法容忍和回避的问题；
      * 在任何时候都不要出现同一个程序中出现两段或更多的相似代码或相同代码，即便在不同程序中，也应尽力避免。开发者应当总是有能力找到避免代码大段(超过10行)重复或类似的情况。</dd>
<dd><strong>需要强调的是，本部分虽然篇幅较短，但却是十分需要经验，并将花费开发者大量时间和精力去进行优化的部分，任何产品开发者必须时刻清楚和理解代码重用的重要性和必要性，切实在增强产品效率、逻辑性和可读性上下功夫，这是一名优秀软件开发者所必须具备的基本素质。</strong></dd>
</dl>

<h3 id="其他细节问题">其他细节问题</h3>

<h4 id="包含调用">包含调用</h4>

<dl>
<dd>* 包含调用程序文件，请全部使用require_once，以避免可能的重复包含问题；

<ul>
<li>包含调用缓存文件，由于缓存文件无法保证100%正确打开，请使用include_once或include。在必要时，可以使用@include_once或@include的方式，以忽略错误提示；</li>
<li>包含和调用代码中，须以“./”或DISCUZ_ROOT.’./’开头，应避免直接写程序文件名(例如：require_once ‘x.php’;)的做法；</li>
<li>所有被包含和调用的程序文件，包括但不限于程序、缓存或模板，通常其不能被直接URL请求。Discuz!通过在./source/class/class_core.php中定义一个标记性常量IN_DISCUZ，来判断程序是否被合法调用。因此，在除了./source/class/class_core.php以外的任何一个被包含和调用的程序文件中，需要包含以下内容，以使得访问者无法直接通过URL请求该文件：</li>
</ul></dd>
</dl>

<pre>if(!defined('IN_DISCUZ')) {
    exit('Access Denied');
}</pre>

<h4 id="错误报告级别">错误报告级别</h4>

<dl>
<dd>* 在软件开发和调试阶段，请使用error_reporting(E_ALL);作为默认的错误报告级别，此级别最为严格，能够报告程序中所有的错误、警告和提示信息，以帮助开发者检查和核对代码，避免大多数安全性问题和逻辑错误、拼写错误。error_reporting()可以在config/config_global.php中添加一行<strong>$_config[&#8216;debug&#8217;] = 1;</strong>debug值可以在0~2之前取值，数值越大报错等级越高。

<ul>
<li>在软件发布时，请使用error_reporting(E_ERROR | E_WARNING | E_PARSE);作为默认的错误报告级别，以利于用户使用并将无谓错误提示信息降至最低。</li>
</ul></dd>
</dl>

<h1 id="数据库设计">数据库设计</h1>

<h2 id="字段">字段</h2>

<h3 id="表和字段命名">表和字段命名</h3>

<dl>
<dd>表和字段的命名以前面《4.4命名原则》的约定为基本准则。</dd>
<dd>所有数据表名称，只要其名称是可数名词，则必须以复数方式命名，例如：cdb_members(用户表)、cdb_posts(帖子表)；存储多项内容的字段，或代表数量的字段，也应当以复数方式命名，例如：params(parameters，自定义Discuz!代码的参数个数)、views(查看次数)、replies(回复次数)。</dd>
<dd>当几个表间的字段有关连时，要注意表与表之间关联字段命名的统一，如cdb_threads表中的tid与cdb_posts表中的tid。</dd>
<dd><p>代表id自增量的字段，通常用以下几种形式：</p></p>

<ul>
<li>最常用的核心id，或经常在URL中进行调用的，尽量用简写的形式，例如tid、pid、uid；</li>
<li>有功能性作用，URL中偶尔用到的id，使用全称的形式，例如pluginid；</li>
<li>没有功能性作用，只为管理和维护方便而设的id，可以使用全称的形式，也可只将其命名为id。</li>
</ul></dd>
</dl>

<p>所有与表、字段相关的命名，请务必大量参考Discuz!现有字段的命名方式，以保证命名的系统性和统一性。</p>

<h3 id="字段结构">字段结构</h3>

<dl>
<dd>* 允许NULL值的字段，数据库在进行比较操作时，会先判断其是否为NULL，非NULL时才进行值的必对。因此基于效率的考虑，所有字段均不能为空，即全部NOT NULL；

<ul>
<li>预计不会存储非负数的字段，例如各项id、发帖数等，必须设置为UNSIGNED类型。UNSIGNED类型比非UNSIGNED类型所能存储的正整数范围大一倍，因此能获得更大的数值存储空间；</li>
<li>存储开关、选项数据的字段，通常使用tinyint(1)非UNSIGNED类型，少数情况也可能使用enum()结果集的方式。tinyint作为开关字段时，通常1为打开；0为关闭；-1为特殊数据，例如N/A(不可用)；高于1的为特殊结果或开关二进制数组合(详见Discuz!中相关代码)；</li>
<li>MEMORY/HEAP类型的表中，要尤其注意规划节约使用存储空间，这将节约更多内存。例如cdb_sessions表中，就将IP地址的存储拆分为4个tinyint(3) UNSIGNED类型的字段，而没有采用char(15)的方式；</li>
<li>任何类型的数据表，字段空间应当本着足够用，不浪费的原则，数值类型的字段取值范围见下表：</li>
</ul></dd>
</dl>

<table border="1" cellspacing="0">
  <tr>
    <td>
      <strong>字段类型</strong>
    </td>
    
    <td>
      <strong>存储空间(b)</strong>
    </td>
    
    <td>
      <strong>UNSIGNED</strong>
    </td>
    
    <td>
      <strong>取值范围</strong>
    </td>
  </tr>
  
  <tr>
    <td rowspan="2">
      tinyint
    </td>
    
    <td rowspan="2">
      1
    </td>
    
    <td>
      否
    </td>
    
    <td>
      -128~127
    </td>
  </tr>
  
  <tr>
    <td>
      是
    </td>
    
    <td>
      0~255
    </td>
  </tr>
  
  <tr>
    <td rowspan="2">
      smallint
    </td>
    
    <td rowspan="2">
      2
    </td>
    
    <td>
      否
    </td>
    
    <td>
      -32768~32767
    </td>
  </tr>
  
  <tr>
    <td>
      是
    </td>
    
    <td>
      0~65535
    </td>
  </tr>
  
  <tr>
    <td rowspan="2">
      mediumint
    </td>
    
    <td rowspan="2">
      3
    </td>
    
    <td>
      否
    </td>
    
    <td>
      -8388608~8388607
    </td>
  </tr>
  
  <tr>
    <td>
      是
    </td>
    
    <td>
      0~16777215
    </td>
  </tr>
  
  <tr>
    <td rowspan="2">
      int
    </td>
    
    <td rowspan="2">
      4
    </td>
    
    <td>
      否
    </td>
    
    <td>
      -2147483648~2147483647
    </td>
  </tr>
  
  <tr>
    <td>
      是
    </td>
    
    <td>
      0~4294967295
    </td>
  </tr>
  
  <tr>
    <td rowspan="2">
      bigint
    </td>
    
    <td rowspan="2">
      8
    </td>
    
    <td>
      否
    </td>
    
    <td>
      -9223372036854775808~9223372036854775807
    </td>
  </tr>
  
  <tr>
    <td>
      是
    </td>
    
    <td>
      0~18446744073709551615
    </td>
  </tr>
</table>

<h2 id="sql语句">SQL语句</h2>

<dl>
<dd>* 所有SQL语句中，除了表名、字段名称以外，全部语句和函数均需大写，应当杜绝小写方式或大小写混杂的写法。例如select * from cdb_members;是不符合规范的写法。

<ul>
<li>很长的SQL语句应当有适当的断行，依据JOIN、FROM、ORDER BY等关键字进行界定。</li>
<li>通常情况下，在对多表进行操作时，要根据不同表名称，对每个表指定一个1~2个字母的缩写，以利于语句简洁和可读性。</li>
</ul></dd>
<dd>如下的语句范例，是符合规范的：</dd>
</dl>

<pre>$query = $db-&gt;query("SELECT s.*, m.* FROM {$tablepre}sessions s, {$tablepre}members m WHERE m.uid=s.uid AND s.sid='$sid');</pre>

<h2 id="性能与效率">性能与效率</h2>

<h3 id="定长与变长表">定长与变长表</h3>

<dl>
<dd><p>包含任何varchar、text等变长字段的数据表，即为变长表，反之则为定长表。</p></p>

<ul>
<li>对于变长表，由于记录大小不同，在其上进行许多删除和更改将会使表中的碎片更多。需要定期运行OPTIMIZE TABLE以保持性能。而定长表就没有这个问题；</li>
<li>如果表中有可变长的字段，将它们转换为定长字段能够改进性能，因为定长记录易于处理。但在试图这样做之前，应该考虑下列问题：</li>
<li>使用定长列涉及某种折衷。它们更快，但占用的空间更多。char(n) 类型列的每个值总要占用n 个字节(即使空串也是如此)，因为在表中存储时，值的长度不够将在右边补空格；</li>
<li>而varchar(n)类型的列所占空间较少，因为只给它们分配存储每个值所需要的空间，每个值再加一个字节用于记录其长度。因此，如果在char和varchar类型之间进行选择，需要对时间与空间作出折衷；</li>
<li>变长表到定长表的转换，不能只转换一个可变长字段，必须对它们全部进行转换。而且必须使用一个ALTER TABLE语句同时全部转换，否则转换将不起作用；</li>
<li>有时不能使用定长类型，即使想这样做也不行。例如对于比255字符更长的串，没有定长类型；</li>
<li>在设计表结构时如果能够使用定长数据类型尽量用定长的，因为定长表的查询、检索、更新速度都很快。必要时可以把部分关键的、承担频繁访问的表拆分，例如定长数据一个表，非定长数据一个表。例如Discuz!的cdb_members和cdb_memberfields表、cdb_forums和cdb_forumfields表等。因此规划数据结构时需要进行全局考虑；</li>
</ul></dd>
</dl>

<p>进行表结构设计时，应当做到恰到好处，反复推敲，从而实现最优的数据存储体系。</p>

<h3 id="运算与检索">运算与检索</h3>

<dl>
<dd>* 数值运算一般比字符串运算更快。例如比较运算，可在单一运算中对数进行比较。而串运算涉及几个逐字节的比较，如果串更长的话，这种比较还要多。

<ul>
<li>如果串列的值数目有限，应该利用普通整型或emum类型来获得数值运算的优越性。</li>
<li>更小的字段类型永远比更大的字段类型处理要快得多。对于字符串，其处理时间与串长度直接相关。一般情况下，较小的表处理更快。对于定长表，应该选择最小的类型，只要能存储所需范围的值即可。例如，如果mediumint够用，就不要选择bigint。对于可变长类型，也仍然能够节省空间。一个TEXT 类型的值用2 字节记录值的长度，而一个LONGTEXT 则用4字节记录其值的长度。如果存储的值长度永远不会超过64KB，使用TEXT 将使每个值节省2字节。</li>
</ul></dd>
</dl>

<h3 id="结构优化与索引优化">结构优化与索引优化</h3>

<dl>
<dd>索引能加快查询速度，而索引优化和查询优化是相辅相成的，既可以依据查询对索引进行优化，也可以依据现有索引对查询进行优化，这取决于修改查询或索引，哪个对现有产品架构和效率的影响最小。</dd>
<dd>索引优化与查询优化是多年经验积累的结晶，在此无法详述，但仍然给出几条最基本的准则。</dd>
<dd>首先，根据产品的实际运行和被访问情况，找出哪些SQL语句是最常被执行的。最常被执行和最常出现在程序中是完全不同的概念。最常被执行的SQL语句，又可被划分为对大表(数据条目多的)和对小表(数据条目少的)的操作。无论大表或小表，有可分为读(SELECT)多、写(UPDATE/INSERT)多或读写都多的操作。</dd>
<dd><p>对常被执行的SQL语句而言，对大表操作需要尤其注意：</p></p>

<dl>
<dd><ul>
<li>写操作多的，通常可使用写入缓存的方法，先将需要写或需要更新的数据缓存至文件或其他表，定期对大表进行批量写操作，例如Discuz!中点击数延迟更新机制，就是依据此原理实现。同时，应尽量使得常被读写的大表为定长类型，即便原本的结构中大表并非定长。大表定长化，可以通过改变数据存储结构和数据读取方式，将一个大表拆成一个读写多的定长表，和一个读多写少的变长表来实现；</li>
</ul>

<ul>
<li>读操作多的，需要依据SQL查询频率设置专门针对高频SQL语句的索引和联合索引。
<br /></li>
</ul></dd>
<dd><p>而小表就相对简单，加入符合查询要求的特定索引，通常效果比较明显。同时，定长化小表也有益于效率和负载能力的提高。字段比较少的小定长表，甚至可以不需要索引。</p></dd>
</dl></dd>
<dd><p>其次，看SQL语句的条件和排序字段是否动态性很高(即根据不同功能开关或属性，SQL查询条件和排序字段的变化很大的情况)，动态性过高的SQL语句是无法通过索引进行优化的。惟一的办法只有将数据缓存起来，定期更新，适用于结果对实效性要求不高的场合。</p></p>

<dl>
<dd>MySQL索引，常用的有PRIMARY KEY、INDEX、UNIQUE几种，详情请查阅MySQL文档。通常，在单表数据值不重复的情况下，PRIMARY KEY和UNIQUE索引比INDEX更快，请酌情使用。</dd>
</dl></dd>
<dd><p>事实上，索引是将条件查询、排序的读操作资源消耗，分布到了写操作中，索引越多，耗费磁盘空间越大，写操作越慢。因此，索引决不能盲目添加。对字段索引与否，最根本的出发点，依次仍然是SQL语句执行的概率、表的大小和写操作的频繁程度。</p></dd>
</dl>

<h3 id="查询优化">查询优化</h3>

<dl>
<dd>MySQL中并没有提供针对查询条件的优化功能，因此需要开发者在程序中对查询条件的先后顺序人工进行优化。例如如下的SQL语句：</dd>
<dt><pre>SELECT * FROM table WHERE a&gt;’0’ AND b&lt;’1’ ORDER BY c LIMIT 10;</pre></dt>
<dd>事实上无论a&gt;’0’还是b&lt;’1’哪个条件在前，得到的结果都是一样的，但查询速度就大不相同，尤其在对大表进行操作时。</dd>
<dd>开发者需要牢记这个原则：最先出现的条件，一定是过滤和排除掉更多结果的条件；第二出现的次之；以此类推。因而，表中不同字段的值的分布，对查询速度有着很大影响。而ORDER BY中的条件，只与索引有关，与条件顺序无关。</dd>
<dd>除了条件顺序优化以外，针对固定或相对固定的SQL查询语句，还可以通过对索引结构进行优化，进而实现相当高的查询速度。原则是：在大多数情况下，根据WHERE条件的先后顺序和ORDER BY的排序字段的先后顺序而建立的联合索引，就是与这条SQL语句匹配的最优索引结构。尽管，事实的产品中不能只考虑一条SQL语句，也不能不考虑空间占用而建立太多的索引。</dd>
<dd>同样以上面的SQL语句为例，最优的当table表的记录达到百万甚至千万级后，可以明显的看到索引优化带来的速度提升。</dd>
<dd>依据上面条件优化和索引优化的两个原则，当table表的值为如下方案时，可以得出最优的条件顺序方案：</dd>
</dl>

<p><table border="1" cellspacing="0">
  <tr>
    <td>
      字段a
    </td></p>

<pre><code>&lt;td&gt;
  字段b
&lt;/td&gt;

&lt;td&gt;
  字段c
&lt;/td&gt;
</code></pre>

<p></tr></p>

<p><tr>
    <td>
      1
    </td></p>

<pre><code>&lt;td&gt;
  7
&lt;/td&gt;

&lt;td&gt;
  11
&lt;/td&gt;
</code></pre>

<p></tr></p>

<p><tr>
    <td>
      2
    </td></p>

<pre><code>&lt;td&gt;
  8
&lt;/td&gt;

&lt;td&gt;
  10
&lt;/td&gt;
</code></pre>

<p></tr></p>

<p><tr>
    <td>
      3
    </td></p>

<pre><code>&lt;td&gt;
  9
&lt;/td&gt;

&lt;td&gt;
  13
&lt;/td&gt;
</code></pre>

<p></tr></p>

<p><tr>
    <td colspan="3">
      最优条件：b&lt;’1’ AND a&gt;’0’最优索引：INDEX abc (b, a, c) 原因：b&lt;’1’作为第一条件可以先过滤掉75%的结果。如果以a&gt;’0’作为第一条件，则只能先过滤掉25%的结果<br /> <strong>注意：</strong></p></p>

<pre><code>  &lt;dl&gt;
    &lt;dd&gt;
      &lt;ul&gt;
        &lt;li&gt;
          字段c由于未出现于条件中，故条件顺序优化与其无关
        &lt;/li&gt;
        &lt;li&gt;
          最优索引由最优条件顺序得来，而非由例子中的SQL语句得来
        &lt;/li&gt;
        &lt;li&gt;
          索引并非修改数据存储的物理顺序，而是通过对应特定偏移量的物理数据而实现的虚拟指针
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/dd&gt;
  &lt;/dl&gt;
&lt;/td&gt;
</code></pre>

<dl>
<dt></table></dt>
<dd>EXPLAIN语句是检测索引和查询能否良好匹配的简便方法。在phpMyAdmin或其他MySQL客户端中运行EXPLAIN+查询语句，例如EXPLAIN SELECT * FROM table WHERE a&gt;’0’ AND b&lt;’1’ ORDER BY c;这种形式，即使得开发者无需模拟上百万条数据，也可以验证索引是否合理，相关细节请参考MySQL说明。</dd>
<dd>值得提出的是，Using filesort是最不应当出现的情况，如果EXPLAIN得出此结果，说明数据库为这个查询专门建立了一个用以缓存结果的临时表文件，并在查询结束后删除。众所周知，硬盘I/O速度始终是计算机存储的瓶颈，因此，查询中应当尽全力避免高执行频率的SQL语句使用filesort。尽管，开发者永远都不可能保证产品中的全部SQL语句都不会使用filesort。</dd>
<dd>限于篇幅，本文档远远没有涵盖数据库优化的方方面面，例如：联合索引与普通索引的可重用性、JOIN连接的索引设计、MEMORY/HEAP表等。数据库优化实际上就是在很多因素和利弊间不断权衡、修改，惟有在成功与失败经验中反复推敲才能得出的经验，这种经验往往就是最难能可贵和价值连城的。</dd>
</dl>

<p>的。</p>

<h3 id="兼容性问题">兼容性问题</h3>

<dl>
<dd>* 由于MySQL 3.23至5.0的变化很大，因此程序中尽量不使用特殊的SQL语句，以免带来兼容性问题，并给数据库移植造成困难。

<ul>
<li>通常在MySQL 4.1以上版本，Discuz!应使用相当的字符集来存储，例如GBK/BIG5/UTF-8。传统的latin1编码虽然有一定的兼容性，但仍然不是推荐的选择。使用相应非默认字符集时，程序每次运行时需要使用SET NAMES ‘character_set’;来规定连接、传输和结果的字符集。</li>
<li>Mysql 5.0以上新增了数种SQL_MODE，默认的SQL_MODE依服务器安装设置不同而不同，因此程序每次运行时需要使用SET SQL_MODE=’’;来规定当前的SQL模式。</li>
</ul></dd>
</dl>

<h1 id="模板设计">模板设计</h1>

<h2 id="代码标记-1">代码标记</h2>

<dl>
<dd>HTML代码标记一律采用小写字母形式，杜绝任何使用大写字母的方式</dd>
<dd>模板中所有的逻辑体，如{if}、{loop}等，必须前后使用HTML注释()，即类似的形式。事实上，Discuz!模板编译器是支持不加HTML注释的逻辑体写法的，但加入注释可以使得模板可读性更好，同时方便用户使用DreamWeaver或FrontPage等对模板进行修改。</dd>
<dd>在HTML标记中使用的逻辑体无需使用HTML注释()，即<input type=”text”{if xxx} value=”1”{/if} /></dd>
</dl>

<h2 id="书写规则-1">书写规则</h2>

<h3 id="html">HTML</h3>

<dl>
<dd>所有HTML标记参数赋值需使用双引号包含，例如，应当使用<input type=”text” name=”test” value=”ok” />,而绝对不能使用<input type=text name=test value=ok />。</dd>
<dd>在任何情况下，产品中的模板文件必须采用手写HTML代码的方式，而绝对不能使用DreamWeaver、FrontPage等自动网页制作工具进行撰写或修改。</dd>
<dd>非成对标记必须以“/&gt;”结尾，如<br />
、<input …/>,<input /> 标记的属性必须按照以下顺序书写：<input type=&#8221;&#8221; name=&#8221;&#8221; id=&#8221;&#8221; class=&#8221;&#8221; … /></dd>
</dl>

<h3 id="变量">变量</h3>

<dl>
<dd><p>模板中使用的变量，依据作用和出现位置不同，分为几种方式：</p></p>

<ul>
<li>逻辑体中，即被包围起来的部分，例如这种形式，其中的变量书写规范与PHP程序中完全一致；</li>
<li>模板内容中，即未被包围起来的部分，与PHP程序中最大的不同是，对数组字符串类型下标无需加入单引号，因为Discuz!模板编译器会在对模板进行编译时将这部分的单引号自动加入。</li>
</ul></dd>
<dd><p>偶尔的，开发者需要使用{}将变量括起来，以免出现模板编译错误，可能的情况如下：</p></p>

<ul>
<li>变量前后含有中括号的或其他敏感字符的(包括但不限于“$”、“’”等)，正确的写法为descriptionnew[{$buddy[buddyid]}]；</li>
<li>数组的下标为变量的，正确的写法为{$extcredits[$creditstrans][title]}；</li>
<li>其他变量十分复杂的情况。</li>
</ul></dd>
</dl>

<h3 id="语言元素">语言元素</h3>

<dl>
<dd>Discuz!模板编译器可以解析对应于./templates/default/templates.lang.php(以默认模板为例)的语言元素。在模板中调用相应语言元素的代码为{lang item}，其中item为在templates.lang.php中定义的语言元素名。</dd>
</dl>

<h3 id="缩进-1">缩进</h3>

<dl>
<dd>在Discuz!的*.htm模板文件中，由于具备逻辑结构，故不考虑任何HTML本身的缩进，所有缩进均意为着逻辑上的缩进结构。缩进采用TAB方式，不使用空格作为缩进符号，仅需适当断行即可。例如：</dd>
</dl>

<pre>&lt;!--{loop $threadlist $thread}--&gt;
    &lt;table cellspacing=”0” cellspadding=”0” border=”0”&gt;
    &lt;tr&gt;&lt;td&gt;$thread[message]&lt;/tr&gt;&lt;/td&gt;
    &lt;/table&gt;
&lt;!--{/loop}--&gt;</pre>

<h1 id="文件与目录">文件与目录</h1>

<h2 id="文件命名">文件命名</h2>

<dl>
<dd>所有包含PHP代码的程序文件或半程序文件，应以小写.php作为扩展名，而不要使用.phtml、.php3、.inc、.class等作为扩展名。</dd>
<dd><p><strong>普通程序</strong></p></p>

<dl>
<dd>能够被URL直接调用的程序，例如home.php、index.php、forum.php，直接使用程序名+.php的方式命名</dd>
</dl></dd>
<dd><p><strong>函数库和类库程序</strong></p></p>

<dl>
<dd>分别以小写function_xxxx.php和class_xxxx.php的格式命名书写。函数库和类库程序只能被其他程序引用，而不能独立运行。其中不能包含任何流程性的、不属于任何函数或类的程序代码。</dd>
</dl></dd>
<dd><p><strong>流程性程序</strong></p></p>

<dl>
<dd>以小写.inc.php作为扩展名。只能被其他程序引用，而不能独立运行。其中不能包含任何函数或类代码的程序代码。</dd>
</dl></dd>
<dd><p><strong>模板源文件</strong></p></p>

<dl>
<dd>以小写.htm作为扩展名。模板源文件按照Discuz!模板编码规则进行编写，不是可以执行的程序，而只能被Discuz!模板编译器所解析，放置于./templates/default或./templates下的其他模板目录下。</dd>
</dl></dd>
<dd><p><strong>模板目标文件</strong></p></p>

<dl>
<dd>模板文件被编译后自动生成的目标程序，以小写.tpl.php作为扩展名，存放于./data/template目录下。</dd>
</dl></dd>
<dd><p><strong>语言包文件</strong></p></p>

<dl>
<dd>* 以小写lang_xxxx.php格式命名，只能存放模板或程序使用的语言包信息。

<ul>
<li>模板语言包存放在对应模块名下的lang_template.php，例如：家园的模板语言包source\language\home\lang_template.php</li>
</ul></dd>
</dl></dd>
<dd><p><strong>缓存文件</strong></p></p>

<dl>
<dd>此类文件为系统自动生成，以cache_xxx.php、usergroup_xxx.php、style_xxx.php等类似形式命名，存放于./data/cache目录下。</dd>
</dl></dd>
</dl>

<h2 id="目录命名">目录命名</h2>

<dl>
<dd>* Discuz!目录命名以前面《4.4命名原则》的约定为基本准则。在可能的情况下，多以复数形式出现，如./templates、./images等。

<ul>
<li>由于目录数量较少，因此目录命名大多是一些习惯和约定俗成，开发人员如需新建目录，应与项目组成员进行磋商，达成一致后方可实施。</li>
</ul></dd>
</dl>

<h2 id="空目录索引">空目录索引</h2>

<dl>
<dd>* 请在所有不包含普通程序(即能够被URL直接调用的程序)的目录中放置一个1字节的index.htm文件，内容为一个空格。几乎除Discuz!根目录以外，所有目录都属于这一类型，因此开发者需要在这些目录全部放入空index.htm文件，以避免当http服务器的Directory Listing打开时，服务器文件被索引和列表。

<ul>
<li>附件目录等敏感目录，要在程序中实现相应功能，当新建下级目录时，必须自动写入一个空的index.htm文件，以避免新建目录被索引的问题。</li>
</ul></dd>
</dl>

    
      <div id="SOHUCS" sid="/463.html" ></div>
<script type="text/javascript">
    (function(){
        var appid = 'cyvbquHcp';
        var conf = 'prod_36ec90d723d85f1042b3c858876d1b2d';
        var width = window.innerWidth || document.documentElement.clientWidth;
        if (width < 960) {
            var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.charset = 'utf-8';
            script.id = 'changyan_mobile_js';
            script.src = 'https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
            head.appendChild(script);
        } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://cy-cdn.kuaizhan.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
    
  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <h2>Funbox</h2>
    <div>
      技术积累记事本，记录自己的点点滴滴。
    </div>
    <a href='https://gofunbox.github.io/about/' class="button mt-1" role="button">Read More</a>
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://gofunbox.github.io/nginx-ban-ip-access-for-http-https/" class="nav-link">Nginx配置禁止IP直接HTTP/HTTPS访问</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/nginx-ssl-performance-optimization/" class="nav-link">Nginx SSL 性能优化</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/linux-autostart-method/" class="nav-link">Linux 添加开机启动项的三种方法</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/ascii-unicode-utf8/" class="nav-link">字符编码简介（ASCII、Unicode、UTF-8）</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/redis-setnx/" class="nav-link">谈谈Redis的SETNX</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/vim-guide/" class="nav-link">Vim 编辑器简单使用教程</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/automake-and-makefile/" class="nav-link">自动化编译 如何生成configure和Makefile</a>
      </li>
      <li>
        <a href="https://gofunbox.github.io/security-https-and-mitm/" class="nav-link">HTTPS原理以及HTTPS中间人攻击</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://gofunbox.github.io/categories/php/' class="post_tag button button_translucent">
          PHP
          <span class="button_tally">53</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/' class="post_tag button button_translucent">
          服务器
          <span class="button_tally">33</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/linux/' class="post_tag button button_translucent">
          LINUX
          <span class="button_tally">19</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/shopex/' class="post_tag button button_translucent">
          SHOPEX
          <span class="button_tally">17</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/' class="post_tag button button_translucent">
          数据库
          <span class="button_tally">15</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/seo/' class="post_tag button button_translucent">
          SEO
          <span class="button_tally">13</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/zencart/' class="post_tag button button_translucent">
          ZENCART
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/' class="post_tag button button_translucent">
          性能优化
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/hack/' class="post_tag button button_translucent">
          HACK
          <span class="button_tally">6</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/html/' class="post_tag button button_translucent">
          HTML
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/wordpress/' class="post_tag button button_translucent">
          WORDPRESS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/' class="post_tag button button_translucent">
          版本管理工具
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/discuz/' class="post_tag button button_translucent">
          DISCUZ
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/shopnc/' class="post_tag button button_translucent">
          SHOPNC
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/thinkphp/' class="post_tag button button_translucent">
          THINKPHP
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/%E4%B8%AA%E4%BA%BA%E6%9D%82%E8%B0%88/' class="post_tag button button_translucent">
          个人杂谈
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://gofunbox.github.io/categories/dedecms/' class="post_tag button button_translucent">
          DEDECMS
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://gofunbox.github.io/tags/linux/' class="post_tag button button_translucent">
          LINUX
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/nginx/' class="post_tag button button_translucent">
          NGINX
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/ssl/' class="post_tag button button_translucent">
          SSL
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/mysql/' class="post_tag button button_translucent">
          MYSQL
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/php/' class="post_tag button button_translucent">
          PHP
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/lua/' class="post_tag button button_translucent">
          LUA
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/html/' class="post_tag button button_translucent">
          HTML
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/javascript/' class="post_tag button button_translucent">
          JAVASCRIPT
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/jenkins/' class="post_tag button button_translucent">
          JENKINS
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/osx/' class="post_tag button button_translucent">
          OSX
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://gofunbox.github.io/tags/vmware/' class="post_tag button button_translucent">
          VMWARE
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
  </section>
</aside>

</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
</svg>

<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://gofunbox.github.io/icons/apple-touch-icon.png' class="icon icon_2 transparent">
    <p>Copyright &copy;&nbsp;<span class="year">2020</span>&nbsp;FUNBOX的技术记事本. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <use xlink:href="#arrow"></use>
</svg>
</a>

  </div>
</footer>
    <script type="text/javascript" src="https://gofunbox.github.io/js/bundle.min.b672f2cf44052c113d188829e5f5d141a97ea83ade7b0c53f92ccb4e415435f0295af95e80e8d88a98bfa8af4c5818e3a2264621195c9cbf74f3c33ca66265d7.js" integrity="sha512-tnLyz0QFLBE9GIgp5fXRQal&#43;qDreewxT&#43;SzLTkFUNfApWvlegOjYipi/qK9MWBjjoiZGIRlcnL9088M8pmJl1w==" crossorigin="anonymous"></script>
    
  </body>
</html>
